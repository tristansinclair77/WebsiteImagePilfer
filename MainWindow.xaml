<Window x:Class="WebsiteImagePilfer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
xmlns:local="clr-namespace:WebsiteImagePilfer"
        xmlns:converters="clr-namespace:WebsiteImagePilfer.Converters"
  mc:Ignorable="d"
 Title="Website Image Pilfer" Height="600" Width="900">
  <Window.Resources>
    <converters:ListViewIndexConverter x:Key="IndexConverter"/>
    </Window.Resources>
    <Grid Margin="{StaticResource MarginStandard}">
        <Grid.RowDefinitions>
         <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
     <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
       <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
       <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
    
        <!-- URL Input Row -->
        <Grid Grid.Row="0" Margin="{StaticResource SectionMarginBottom}">
     <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
     <ColumnDefinition Width="Auto"/>
   <ColumnDefinition Width="Auto"/>
     <ColumnDefinition Width="Auto"/>
<ColumnDefinition Width="Auto"/>
   <ColumnDefinition Width="Auto"/>
       </Grid.ColumnDefinitions>
   
    <TextBox x:Name="UrlTextBox" 
 Grid.Column="0"
    Style="{StaticResource StandardTextBox}"
     Margin="{StaticResource MarginRightStandard}"
         Text="{Binding Url, UpdateSourceTrigger=PropertyChanged}"/>
    
       <Button x:Name="ScanOnlyButton" 
     Grid.Column="1"
     Style="{StaticResource PrimaryButton}"
   Content="Scan" 
   Margin="{StaticResource MarginRightSmall}"
          Command="{Binding ScanCommand}"
          IsEnabled="{Binding IsScanEnabled}"/>
   
       <CheckBox x:Name="FastScanCheckBox"
     Grid.Column="2"
    Content="Fast"
   VerticalAlignment="Center"
    Margin="{StaticResource MarginRightStandard}"
       IsChecked="{Binding IsFastScan}"
        ToolTip="Fast: Quick scan (5s wait)&#x0a;Unchecked: Thorough scan (waits for all lazy-loaded images)"/>

          <Button x:Name="DownloadButton" 
  Grid.Column="3"
    Style="{StaticResource PrimaryWideButton}"
    Content="Download" 
    Margin="{StaticResource MarginRightSmall}"
        Command="{Binding DownloadCommand}"
        IsEnabled="{Binding IsDownloadEnabled}"
  ToolTip="Download all ready images"/>
       
     <Button x:Name="DownloadSelectedButton" 
           Grid.Column="4"
 Style="{StaticResource PrimaryExtraWideButton}"
     Content="Download Selected" 
  Margin="{StaticResource MarginRightSmall}"
     Command="{Binding DownloadSelectedCommand}"
     IsEnabled="{Binding IsDownloadSelectedEnabled}"
ToolTip="Download only selected images"/>
        
     <Button x:Name="CancelButton" 
    Grid.Column="5"
   Style="{StaticResource StandardButton}"
  Content="Cancel" 
           Command="{Binding CancelCommand}"
         IsEnabled="{Binding IsCancelEnabled}"/>
        </Grid>
    
        <!-- Progress Bar -->
  <ProgressBar x:Name="DownloadProgress" 
          Grid.Row="1"
 Style="{StaticResource StandardProgressBar}"
  Value="{Binding ProgressValue}"/>
 
 <!-- Folder Selection -->
   <Grid Grid.Row="2" Margin="{StaticResource SectionMarginBottom}" MinHeight="{StaticResource RowHeightSmall}">
   <Grid.ColumnDefinitions>
 <ColumnDefinition Width="Auto"/>
   <ColumnDefinition Width="*"/>
     <ColumnDefinition Width="Auto"/>
<ColumnDefinition Width="Auto"/>
  <ColumnDefinition Width="Auto"/>
     <ColumnDefinition Width="Auto"/>
     <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
 
<TextBlock Grid.Column="0" 
     Style="{StaticResource LabelText}"
     Text="Save to:"/>
   
<TextBox x:Name="FolderTextBox" 
   Grid.Column="1"
 Style="{StaticResource SmallTextBox}"
  Margin="{StaticResource MarginRightStandard}"
    IsReadOnly="True"
    Text="{Binding DownloadFolder, Mode=OneWay}"/>
       
   <Button x:Name="BrowseButton" 
     Grid.Column="2"
Style="{StaticResource SmallButton}"
    Content="Browse..." 
  Margin="{StaticResource MarginRightMedium}"
   Command="{Binding BrowseFolderCommand}"/>
   
     <Button x:Name="UpFolderButton" 
 Grid.Column="3"
 Style="{StaticResource SmallNarrowButton}"
  Content="Up ▲" 
       Margin="{StaticResource MarginRightMedium}"
      Command="{Binding UpFolderCommand}"
       ToolTip="Go up one folder level"/>
      
     <Button x:Name="NewFolderButton" 
  Grid.Column="4"
 Style="{StaticResource SmallButton}"
   Content="New Folder" 
Margin="{StaticResource MarginRightMedium}"
   Command="{Binding NewFolderCommand}"
        ToolTip="Create a new folder in the current location"/>
        
<Button x:Name="OpenFolderButton" 
    Grid.Column="5"
Style="{StaticResource SmallButton}"
    Content="Open Folder" 
       Margin="{StaticResource MarginRightMedium}"
     Command="{Binding OpenFolderCommand}"
        ToolTip="Open the download folder in File Explorer"/>
   
  <Button x:Name="SettingsButton" 
 Grid.Column="6"
      Style="{StaticResource SmallButton}"
    Content="Settings..." 
  Command="{Binding SettingsCommand}"/>
  </Grid>
        
    <!-- Status Filter Section -->
   <Expander Grid.Row="3" 
 Style="{StaticResource StandardExpander}"
   Header="Status Filters" 
IsExpanded="True">
    <Border Style="{StaticResource FilterBorder}">
      <WrapPanel Orientation="Horizontal">
   <CheckBox x:Name="FilterReadyCheckBox" 
 Style="{StaticResource FilterCheckBox}"
    Content="Ready" 
      IsChecked="{Binding FilterReady}"/>
  <CheckBox x:Name="FilterDoneCheckBox" 
      Style="{StaticResource FilterCheckBox}"
     Content="✓ Done" 
    IsChecked="{Binding FilterDone}"/>
       <CheckBox x:Name="FilterBackupCheckBox" 
  Style="{StaticResource FilterCheckBox}"
   Content="✓ Backup" 
   IsChecked="{Binding FilterBackup}"/>
<CheckBox x:Name="FilterDuplicateCheckBox" 
  Style="{StaticResource FilterCheckBox}"
 Content="⊘ Duplicate" 
       IsChecked="{Binding FilterDuplicate}"/>
          <CheckBox x:Name="FilterFailedCheckBox" 
           Style="{StaticResource FilterCheckBox}"
       Content="✗ Failed" 
 IsChecked="{Binding FilterFailed}"/>
     <CheckBox x:Name="FilterSkippedCheckBox" 
     Style="{StaticResource FilterCheckBox}"
 Content="⊘ Skipped" 
IsChecked="{Binding FilterSkipped}"/>
  <CheckBox x:Name="FilterCancelledCheckBox" 
 Style="{StaticResource FilterCheckBox}"
   Content="⊘ Cancelled" 
           IsChecked="{Binding FilterCancelled}"/>
     <CheckBox x:Name="FilterDownloadingCheckBox" 
Style="{StaticResource FilterCheckBox}"
      Content="Downloading..." 
     IsChecked="{Binding FilterDownloading}"/>
          <CheckBox x:Name="FilterIgnoredCheckBox" 
Style="{StaticResource FilterCheckBox}"
      Content="Ignored" 
     IsChecked="{Binding FilterIgnored}"/>
 <Separator Width="20" Opacity="0" Margin="0,3,0,3"/>
    <Button x:Name="SelectAllStatusButton" 
   Style="{StaticResource TinyButton}"
   Content="Select All" 
  Margin="{StaticResource MarginFilterItem}"
             Command="{Binding SelectAllStatusCommand}"/>
  <Button x:Name="ClearAllStatusButton" 
  Style="{StaticResource TinyButton}"
    Content="Clear All"
          Margin="{StaticResource MarginFilterItem}"
     Command="{Binding ClearAllStatusCommand}"/>
     </WrapPanel>
   </Border>
    </Expander>
 
      <!-- Image List -->
        <ListView x:Name="ImageList" 
Grid.Row="4"
           Style="{StaticResource StandardListView}"
          SelectionMode="Extended"
         ItemsSource="{Binding CurrentPageItems}"
 SelectionChanged="ImageList_SelectionChanged"
     MouseDoubleClick="ImageList_MouseDoubleClick">
 <ListView.ContextMenu>
      <ContextMenu Opened="ContextMenu_Opened">
       <MenuItem x:Name="ContextMenu_Download" Header="Download (Force)" Click="ContextMenu_Download_Click" />
  <MenuItem x:Name="ContextMenu_ReloadPreview" Header="Reload Preview" Click="ContextMenu_ReloadPreview_Click" />
      <Separator />
        <MenuItem x:Name="ContextMenu_Ignore" Header="Ignore" Click="ContextMenu_Ignore_Click" />
        <MenuItem x:Name="ContextMenu_Unignore" Header="Unignore" Click="ContextMenu_Unignore_Click" />
      <Separator />
        <MenuItem x:Name="ContextMenu_Cancel" Header="Cancel Download" Click="ContextMenu_Cancel_Click" />
       </ContextMenu>
  </ListView.ContextMenu>
      <ListView.View>
  <GridView>
        <GridViewColumn Header="#" Width="{StaticResource ColumnWidthTiny}">
     <GridViewColumn.CellTemplate>
  <DataTemplate>
 <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, 
      Converter={StaticResource IndexConverter}}"
       HorizontalAlignment="Center"/>
  </DataTemplate>
 </GridViewColumn.CellTemplate>
   </GridViewColumn>
  <GridViewColumn x:Name="PreviewColumn" Header="Preview" Width="{StaticResource ColumnWidthMedium}">
 <GridViewColumn.CellTemplate>
   <DataTemplate>
<Image Source="{Binding PreviewImage}" 
     MaxWidth="{Binding Path=ActualWidth, RelativeSource={RelativeSource AncestorType=GridViewColumn}}" 
       Stretch="Uniform"
      Margin="{StaticResource MarginSmall}"
     HorizontalAlignment="Center"
 VerticalAlignment="Center"
  RenderOptions.BitmapScalingMode="Fant"
   UseLayoutRounding="True"
 SnapsToDevicePixels="True"/>
   </DataTemplate>
     </GridViewColumn.CellTemplate>
        </GridViewColumn>
        <GridViewColumn Header="Status" Width="{StaticResource ColumnWidthNarrow}">
      <GridViewColumn.CellTemplate>
 <DataTemplate>
    <TextBlock Text="{Binding Status}" VerticalAlignment="Center" Padding="3"/>
     </DataTemplate>
           </GridViewColumn.CellTemplate>
  </GridViewColumn>
<GridViewColumn Header="Image URL" Width="{StaticResource ColumnWidthExtraWide}">
     <GridViewColumn.CellTemplate>
   <DataTemplate>
 <TextBlock Text="{Binding Url}" 
 TextTrimming="CharacterEllipsis" 
   VerticalAlignment="Center"
  Padding="3"
  ToolTip="{Binding Url}"/>
      </DataTemplate>
  </GridViewColumn.CellTemplate>
      </GridViewColumn>
   <GridViewColumn Header="Filename" Width="{StaticResource ColumnWidthMedium}">
    <GridViewColumn.CellTemplate>
  <DataTemplate>
      <TextBlock Text="{Binding FileName}" VerticalAlignment="Center" Padding="3"/>
  </DataTemplate>
     </GridViewColumn.CellTemplate>
   </GridViewColumn>
   <GridViewColumn Header="Error" Width="{StaticResource ColumnWidthWide}">
 <GridViewColumn.CellTemplate>
      <DataTemplate>
     <TextBlock Style="{StaticResource ErrorText}"
       Text="{Binding ErrorMessage}" 
 VerticalAlignment="Center"
         Padding="3"
  ToolTip="{Binding ErrorMessage}"/>
    </DataTemplate>
   </GridViewColumn.CellTemplate>
        </GridViewColumn>
  </GridView>
  </ListView.View>
 </ListView>
      
   <!-- Pagination Controls -->
      <Grid Grid.Row="5" MinHeight="{StaticResource RowHeightSmall}" Margin="{StaticResource MarginBottomStandard}">
  <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
<ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="Auto"/>
   <ColumnDefinition Width="*"/>
     </Grid.ColumnDefinitions>
   
      <Button x:Name="PrevPageButton" 
  Grid.Column="1"
   Style="{StaticResource SmallButton}"
          Content="◄ Previous" 
   Margin="{StaticResource MarginRightStandard}"
  Command="{Binding PrevPageCommand}"
      IsEnabled="{Binding IsPrevPageEnabled}"/>
          
   <TextBlock x:Name="PageInfoText"
    Grid.Column="2"
       Style="{StaticResource PageInfoText}"
  Text="{Binding PageInfoText}"/>
 
<Button x:Name="NextPageButton" 
         Grid.Column="3"
  Style="{StaticResource SmallButton}"
Content="Next ►" 
  Margin="{StaticResource MarginRightStandard}"
        Command="{Binding NextPageCommand}"
        IsEnabled="{Binding IsNextPageEnabled}"/>
        </Grid>
        
  <!-- Status Bar -->
        <StatusBar Grid.Row="6" Style="{StaticResource StandardStatusBar}">
     <StatusBarItem>
    <TextBlock x:Name="StatusText" Text="{Binding StatusText}"/>
      </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
